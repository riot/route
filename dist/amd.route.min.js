define(function(){"use strict";var e=function(u){u=u||{};var o={},s=Array.prototype.slice;Object.defineProperties(u,{on:{value:function(e,t){if(typeof t=="function"){(o[e]=o[e]||[]).push(t)}return u},enumerable:false,writable:false,configurable:false},off:{value:function(e,t){if(e=="*"&&!t){o={}}else{if(t){var n=o[e];for(var r=0,i;i=n&&n[r];++r){if(i==t){n.splice(r--,1)}}}else{delete o[e]}}return u},enumerable:false,writable:false,configurable:false},one:{value:function(e,t){function n(){u.off(e,n);t.apply(u,arguments)}return u.on(e,n)},enumerable:false,writable:false,configurable:false},trigger:{value:function(e){var t=arguments;var n=arguments.length-1,r=new Array(n),i,f,a;for(a=0;a<n;a++){r[a]=t[a+1]}i=s.call(o[e]||[],0);for(a=0;f=i[a];++a){f.apply(u,r)}if(o["*"]&&e!="*"){u.trigger.apply(u,["*",e].concat(r))}return u},enumerable:false,writable:false,configurable:false}});return u};var r=/^.+?\/\/+[^/]+/,t="EventListener",n="remove"+t,i="add"+t,f="hasAttribute",a="popstate",u="hashchange",o="trigger",s=3,c=typeof window!="undefined"&&window,l=typeof document!="undefined"&&document,h=c&&history,p=c&&(h.location||c.location),v=P.prototype,d=l&&l.ontouchstart?"touchstart":"click",m=e();var b=false,g=false,y=false,w,E,$,_,A=[],S=0;function x(e){return e.split(/[/?#]/)}function K(e,t){var n=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*");var r=new RegExp("^"+n+"$");var i=e.match(r);if(i){return i.slice(1)}}function N(e,t){var n;return function(){clearTimeout(n);n=setTimeout(e,t)}}function O(e){w=N(B,1);c[i](a,w);c[i](u,w);l[i](d,D);if(e){B(true)}}function P(){this.$=[];e(this);m.on("stop",this.s.bind(this));m.on("emit",this.e.bind(this))}function T(e){return e.replace(/^\/|\/$/,"")}function j(e){return typeof e=="string"}function k(e){return(e||p.href).replace(r,"")}function q(e){var t=z._.base;return t[0]==="#"?(e||p.href||"").split(t)[1]||"":(p?k(e):e||"").replace(t,"")}function B(t){var e=S===0;if(s<=S){return}L();if(g){return}S++;A.push(function(){var e=q();if(t||e!==E){m[o]("emit",e);E=e}});if(e){var n;while(n=A.shift()){n()}S=0}}function D(e){if(e.which!==1||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented){return}var t=e.target;while(t&&t.nodeName!=="A"){t=t.parentNode}if(!t||t.nodeName!=="A"||t[f]("download")||!t[f]("href")||t.target&&t.target!=="_self"||t.href.indexOf(p.href.match(r)[0])===-1){return}var n=z._.base;if(t.href!==p.href&&(t.href.split("#")[0]===p.href.split("#")[0]||n[0]!=="#"&&k(t.href).indexOf(n)!==0||n[0]==="#"&&t.href.split(n)[0]!==p.href.split(n)[0]||!F(q(t.href),t.title||l.title))){return}e.preventDefault()}function F(e,t,n){if(!h){return m[o]("emit",q(e))}e=z._.base+T(e);t=t||l.title;n?h.replaceState(null,t,e):h.pushState(null,t,e);l.title=t;y=false;B();return y}var L=function(){var e=l&&l.createEvent&&l.createEvent("Event");if(!e){return function(){}}e.initEvent("route.trigger",true,true);return function(){return c.dispatchEvent(e)}}();v.m=function(e,t,n){if(j(e)&&(!t||j(t))){F(e,t,n||false)}else if(t){this.r(e,t)}else{this.r("@",e)}};v.s=function(){this.off("*");this.$=[]};v.e=function(n){this.$.concat("@").some(function(e){var t=(e==="@"?$:_)(T(n),T(e));if(typeof t!="undefined"){this[o].apply(null,[e].concat(t));return y=true}},this)};v.r=function(e,t){if(e!=="@"){e="/"+T(e);this.$.push(e)}this.on(e,t)};var R=new P;var z=R.m.bind(R);z._={base:null,getPathFromBase:q};z.create=function(){var e=new P;var t=e.m.bind(e);t.stop=e.s.bind(e);return t};z.base=function(e){z._.base=e||"#";E=q()};z.exec=function(){B(true)};z.parser=function(e,t){if(!e&&!t){$=x;_=K}if(e){$=e}if(t){_=t}};z.query=function(){var r={};var e=p.href||E;e.replace(/[?&](.+?)=([^&]*)/g,function(e,t,n){r[t]=n});return r};z.suspend=function(){if(b&&!g){b=false;g=true}};z.resume=function(){if(g){g=false;b=true}};z.stop=function(){if(b){if(c){c[n](a,w);c[n](u,w);l[n](d,D)}m[o]("stop");b=false;g=false}};z.start=function(e){if(!b){if(c){if(document.readyState==="interactive"||document.readyState==="complete"){O(e)}else{document.onreadystatechange=function(){if(document.readyState==="interactive"){setTimeout(function(){O(e)},1)}}}}b=true}};z.base();z.parser();return z});