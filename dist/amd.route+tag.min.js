define(["riot"],function(e){"use strict";e=e&&e.hasOwnProperty("default")?e["default"]:e;var t=function(f){f=f||{};var o={},c=Array.prototype.slice;Object.defineProperties(f,{on:{value:function(e,t){if(typeof t=="function"){(o[e]=o[e]||[]).push(t)}return f},enumerable:false,writable:false,configurable:false},off:{value:function(e,t){if(e=="*"&&!t){o={}}else{if(t){var n=o[e];for(var r=0,i;i=n&&n[r];++r){if(i==t){n.splice(r--,1)}}}else{delete o[e]}}return f},enumerable:false,writable:false,configurable:false},one:{value:function(e,t){function n(){f.off(e,n);t.apply(f,arguments)}return f.on(e,n)},enumerable:false,writable:false,configurable:false},trigger:{value:function(e){var t=arguments;var n=arguments.length-1,r=new Array(n),i,a,u;for(u=0;u<n;u++){r[u]=t[u+1]}i=c.call(o[e]||[],0);for(u=0;a=i[u];++u){a.apply(f,r)}if(o["*"]&&e!="*"){f.trigger.apply(f,["*",e].concat(r))}return f},enumerable:false,writable:false,configurable:false}});return f};var r=/^.+?\/\/+[^/]+/,n="EventListener",i="remove"+n,a="add"+n,u="hasAttribute",f="popstate",o="hashchange",c="trigger",s=3,l=typeof window!="undefined"&&window,h=typeof document!="undefined"&&document,p=l&&history,d=l&&(p.location||l.location),v=N.prototype,m=h&&h.ontouchstart?"touchstart":"click",g=t();var w=false,y=false,b=false,E,_,$,A,O=[],P=0;function S(e){return e.split(/[/?#]/)}function T(e,t){var n=t.replace(/\?/g,"\\?").replace(/\*/g,"([^/?#]+?)").replace(/\.\./,".*");var r=new RegExp("^"+n+"$");var i=e.match(r);if(i){return i.slice(1)}}function x(e,t){var n;return function(){clearTimeout(n);n=setTimeout(e,t)}}function K(e){E=x(q,1);l[a](f,E);l[a](o,E);h[a](m,D);if(e){q(true)}}function N(){this.$=[];t(this);g.on("stop",this.s.bind(this));g.on("emit",this.e.bind(this))}function j(e){return e.replace(/^\/|\/$/,"")}function k(e){return typeof e=="string"}function B(e){return(e||d.href).replace(r,"")}function F(e){var t=C._.base;return t[0]==="#"?(e||d.href||"").split(t)[1]||"":(d?B(e):e||"").replace(t,"")}function q(t){var e=P===0;if(s<=P){return}R();if(y){return}P++;O.push(function(){var e=F();if(t||e!==_){g[c]("emit",e);_=e}});if(e){var n;while(n=O.shift()){n()}P=0}}function D(e){if(e.which!==1||e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented){return}var t=e.target;while(t&&t.nodeName!=="A"){t=t.parentNode}if(!t||t.nodeName!=="A"||t[u]("download")||!t[u]("href")||t.target&&t.target!=="_self"||t.href.indexOf(d.href.match(r)[0])===-1){return}var n=C._.base;if(t.href!==d.href&&(t.href.split("#")[0]===d.href.split("#")[0]||n[0]!=="#"&&B(t.href).indexOf(n)!==0||n[0]==="#"&&t.href.split(n)[0]!==d.href.split(n)[0]||!L(F(t.href),t.title||h.title))){return}e.preventDefault()}function L(e,t,n){if(!p){return g[c]("emit",F(e))}e=C._.base+j(e);t=t||h.title;n?p.replaceState(null,t,e):p.pushState(null,t,e);h.title=t;b=false;q();return b}var R=function(){var e=h&&h.createEvent&&h.createEvent("Event");if(!e){return function(){}}e.initEvent("route.trigger",true,true);return function(){return l.dispatchEvent(e)}}();v.m=function(e,t,n){if(k(e)&&(!t||k(t))){L(e,t,n||false)}else if(t){this.r(e,t)}else{this.r("@",e)}};v.s=function(){this.off("*");this.$=[]};v.e=function(n){this.$.concat("@").some(function(e){var t=(e==="@"?$:A)(j(n),j(e));if(typeof t!="undefined"){this[c].apply(null,[e].concat(t));return b=true}},this)};v.r=function(e,t){if(e!=="@"){e="/"+j(e);this.$.push(e)}this.on(e,t)};var z=new N;var C=z.m.bind(z);C._={base:null,getPathFromBase:F};C.create=function(){var e=new N;var t=e.m.bind(e);t.stop=e.s.bind(e);return t};C.base=function(e){C._.base=e||"#";_=F()};C.exec=function(){q(true)};C.parser=function(e,t){if(!e&&!t){$=S;A=T}if(e){$=e}if(t){A=t}};C.query=function(){var r={};var e=d.href||_;e.replace(/[?&](.+?)=([^&]*)/g,function(e,t,n){r[t]=n});return r};C.suspend=function(){if(w&&!y){w=false;y=true}};C.resume=function(){if(y){y=false;w=true}};C.stop=function(){if(w){if(l){l[i](f,E);l[i](o,E);h[i](m,D)}g[c]("stop");w=false;y=false}};C.start=function(e){if(!w){if(l){if(document.readyState==="interactive"||document.readyState==="complete"){K(e)}else{document.onreadystatechange=function(){if(document.readyState==="interactive"){setTimeout(function(){K(e)},1)}}}}w=true}};C.base();C.parser();e.tag2("router","<yield></yield>","","",function(e){var n=this;this.route=C.create();this.select=function(t){[].concat(n.tags.route).forEach(function(e){return e.show=e===t})};this.on("mount",function(){window.setTimeout(function(){return C.start(true)},0)});this.on("unmount",function(){n.route.stop()})});e.tag2("route",'<virtual if="{show}"><yield></yield></virtual>',"","",function(e){var n=this;this.show=false;var t=function(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];n.one("updated",function(){i(n.tags).forEach(function(e){e.trigger.apply(e,["route"].concat(t));e.update()})});n.parent.select(n);n.parent.update()};var r=!!window&&!!window.route&&!!window.route._?window.route._.getPathFromBase:function(){return""};if(e.path===r()){setTimeout(t,0)}this.parent.route(e.path,t);function i(t){return Object.keys(t).map(function(e){return t[e]}).reduce(function(e,t){return e.concat(t)},[])}});return C});